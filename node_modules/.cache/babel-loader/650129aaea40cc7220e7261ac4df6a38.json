{"ast":null,"code":"import request from 'request';\nimport { getLoanStartDay } from './../../utility/time';\nimport { getSymbol } from './../../utility/symbol';\nimport { ethers } from 'ethers';\nimport { SUBGRAPH_API_URL } from '../../utility/constants';\nexport function lendPools(address, setpoollendData) {\n  let result;\n  const data = JSON.stringify({\n    query: `{\n            pools{\n              id\n              lenders{\n                id\n              }\n              lentAmount\n              borrowRate\n              borrowAmountRequested\n              loanStatus\n              published\n              loanStartTime\n              idealCollateralRatio\n              borrowAsset\n              borrower{\n                id \n                twitterDetails{\n                    twitterId\n                }\n            }\n            }\n          }          \n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': SUBGRAPH_API_URL,\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  result = request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    var pools = [];\n\n    if (body) {\n      if (body.data) {\n        if (body.data.pools && body.data.pools.length > 0) {\n          let poolData = body.data.pools;\n\n          for (var i = 0; i < poolData.length; i++) {\n            if (getLoanStartDay(poolData[i].loanStartTime) !== 0) {\n              if (poolData[i].lenders.includes(address)) {\n                var pool = {\n                  id: 2,\n                  name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  username: '@' + ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  pool_type: 'Open Borrow',\n                  pool_status: poolData[i].loanStatus,\n                  participating: true,\n                  borrow_rate: poolData[i].borrowRate / 10 ** 8 + '%',\n                  borrowing: poolData[i].borrowAmountRequested / 10 ** 18 + ' ' + getSymbol(poolData[i].borrowAsset),\n                  locked_collateral: poolData[i].idealCollateralRatio / 10 ** 8 + '%',\n                  collection_progress: Math.floor(poolData[i].lentAmount * 100 / poolData[i].borrowAmountRequested) + '%',\n                  lent: '700 DOT at 10%',\n                  address: poolData[i].id\n                };\n              } else {\n                var pool = {\n                  id: 2,\n                  name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  username: '@' + ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  pool_type: 'Open Borrow',\n                  pool_status: poolData[i].loanStatus,\n                  borrow_rate: poolData[i].borrowRate / 10 ** 8 + '%',\n                  participating: false,\n                  borrowing: poolData[i].borrowAmountRequested / 10 ** 18 + ' ' + getSymbol(poolData[i].borrowAsset),\n                  locked_collateral: poolData[i].idealCollateralRatio / 10 ** 8 + '%',\n                  collection_progress: Math.floor(poolData[i].lentAmount * 100 / poolData[i].borrowAmountRequested) + '%',\n                  address: poolData[i].id\n                };\n              }\n\n              pools.push(pool);\n            }\n          }\n        }\n      }\n    }\n\n    setpoollendData(pools);\n  });\n}\n;","map":{"version":3,"sources":["/Users/ritikdutta/Desktop/sublime-frontend/src/query/pool/lendPool.js"],"names":["request","getLoanStartDay","getSymbol","ethers","SUBGRAPH_API_URL","lendPools","address","setpoollendData","result","data","JSON","stringify","query","options","error","response","Error","body","parse","pools","length","poolData","i","loanStartTime","lenders","includes","pool","id","name","utils","parseBytes32String","borrower","twitterDetails","twitterId","username","pool_type","pool_status","loanStatus","participating","borrow_rate","borrowRate","borrowing","borrowAmountRequested","borrowAsset","locked_collateral","idealCollateralRatio","collection_progress","Math","floor","lentAmount","lent","push"],"mappings":"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","sourcesContent":["import request from 'request'\n\nimport {getLoanStartDay} from './../../utility/time'\nimport {getSymbol} from './../../utility/symbol'\nimport {ethers} from 'ethers'\nimport {SUBGRAPH_API_URL} from '../../utility/constants'\n\nexport function lendPools(address,setpoollendData){\n\n    let result;\n\n    const data = JSON.stringify({\n        query: `{\n            pools{\n              id\n              lenders{\n                id\n              }\n              lentAmount\n              borrowRate\n              borrowAmountRequested\n              loanStatus\n              published\n              loanStartTime\n              idealCollateralRatio\n              borrowAsset\n              borrower{\n                id \n                twitterDetails{\n                    twitterId\n                }\n            }\n            }\n          }          \n          `\n    })\n\n    var options = {\n        'method': 'POST',\n        'url': SUBGRAPH_API_URL,\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n\n    result = request(options, async function (error, response) {\n\n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        var pools = []\n        if(body){\n            if(body.data){\n                if(body.data.pools && body.data.pools.length>0){\n                    let poolData = body.data.pools\n                    for(var i =0;i<poolData.length;i++){\n                        if(getLoanStartDay( poolData[i].loanStartTime) !== 0){\n                            if(poolData[i].lenders.includes(address)){\n                                var pool = {\n                                    id: 2,\n                                    name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    username: '@'+ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    pool_type: 'Open Borrow',\n                                    pool_status: poolData[i].loanStatus,\n                                    participating: true,\n                                    borrow_rate: (poolData[i].borrowRate)/10**8+'%',\n                                    borrowing: (poolData[i].borrowAmountRequested)/10**18+' '+ getSymbol(poolData[i].borrowAsset),\n                                    locked_collateral: (poolData[i].idealCollateralRatio)/10**8+'%',\n                                    collection_progress: Math.floor((poolData[i].lentAmount*100/poolData[i].borrowAmountRequested))+'%',\n                                    lent: '700 DOT at 10%',\n                                    address:poolData[i].id\n                                }\n                            }\n                            else{\n                                var pool = {\n                                    id: 2,\n                                    name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    username: '@'+ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    pool_type: 'Open Borrow',\n                                    pool_status: poolData[i].loanStatus,\n                                    borrow_rate: (poolData[i].borrowRate)/10**8 +'%',\n                                    participating: false,\n                                    borrowing: (poolData[i].borrowAmountRequested)/10**18+' '+ getSymbol(poolData[i].borrowAsset),\n                                    locked_collateral: (poolData[i].idealCollateralRatio)/10**8+'%',\n                                    collection_progress: Math.floor(poolData[i].lentAmount*100/poolData[i].borrowAmountRequested)+'%',\n                                    address:poolData[i].id\n                                }\n                            }\n                            pools.push(pool)\n                        }\n                        \n                    }\n                    \n                }\n            }\n            \n        }\n        setpoollendData(pools)\n    })\n    \n};"]},"metadata":{},"sourceType":"module"}