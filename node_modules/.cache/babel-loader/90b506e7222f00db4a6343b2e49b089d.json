{"ast":null,"code":"import request from 'request';\nimport { getLoanStartDay } from './../../utility/time';\nimport { getSymbol } from './../../utility/symbol';\nimport { SUBGRAPH_API_URL } from '../../utility/constants';\nimport { ethers } from 'ethers';\nexport function borrowPools(address, setpoolBorrowData) {\n  let result;\n  const data = JSON.stringify({\n    query: `{\n            users(where:{id:\"${address}\"} ){\n              id\n              borrowingPools {\n                id\n                borrower{\n                    twitterDetails{\n                        twitterId\n                    }\n                }\n                borrowRate\n                borrowAmountRequested\n                loanStatus\n                published\n                loanStartTime\n                lentAmount\n                borrowAsset\n              }\n            }\n          }\n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': SUBGRAPH_API_URL,\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  result = request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    var pools = [];\n\n    if (body) {\n      if (body.data) {\n        if (body.data.users && body.data.users.length > 0) {\n          if (body.data.users[0].borrowingPools) {\n            let poolData = body.data.users[0].borrowingPools;\n\n            for (var i = 0; i < poolData.length; i++) {\n              if (getLoanStartDay(poolData[i].loanStartTime) != 0) {\n                var pool = {\n                  id: i + 1,\n                  avatar: '',\n                  name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  username: '@' + ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                  pool_type: 'Open Borrow',\n                  pool_status: poolData[i].loanStatus,\n                  // pool_status: 'Active',\n                  created_on: '18th Jan 2021',\n                  borrow_rate: poolData[i].borrowRate / 10 ** 8 + '%',\n                  borrowed_amount: poolData[i].borrowAmountRequested / 10 ** 18 + ' ' + getSymbol(poolData[i].borrowAsset),\n                  progress_and_payment_txt: 'Collection Progress',\n                  progress_and_payment: Math.floor(poolData[i].lentAmount * 100 / poolData[i].borrowAmountRequested) + '%',\n                  next_payment: '200 DOT',\n                  ends_date: getLoanStartDay(poolData[i].loanStartTime),\n                  btn_1: 'Provide collateral',\n                  btn_2: 'View More',\n                  address: poolData[i].id\n                };\n                pools.push(pool);\n              }\n            }\n          }\n        }\n      }\n    }\n\n    setpoolBorrowData(pools);\n  });\n}\n;","map":{"version":3,"sources":["/Users/ritikdutta/Desktop/sublime-frontend/src/query/pool/borrowingPools.js"],"names":["request","getLoanStartDay","getSymbol","SUBGRAPH_API_URL","ethers","borrowPools","address","setpoolBorrowData","result","data","JSON","stringify","query","options","error","response","Error","body","parse","pools","users","length","borrowingPools","poolData","i","loanStartTime","pool","id","avatar","name","utils","parseBytes32String","borrower","twitterDetails","twitterId","username","pool_type","pool_status","loanStatus","created_on","borrow_rate","borrowRate","borrowed_amount","borrowAmountRequested","borrowAsset","progress_and_payment_txt","progress_and_payment","Math","floor","lentAmount","next_payment","ends_date","btn_1","btn_2","push"],"mappings":"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","sourcesContent":["import request from 'request'\n\nimport {getLoanStartDay} from './../../utility/time'\nimport {getSymbol} from './../../utility/symbol'\nimport {SUBGRAPH_API_URL} from '../../utility/constants'\nimport {ethers} from 'ethers'\n\nexport function borrowPools(address,setpoolBorrowData){\n\n    let result;\n\n    const data = JSON.stringify({\n        query: `{\n            users(where:{id:\"${address}\"} ){\n              id\n              borrowingPools {\n                id\n                borrower{\n                    twitterDetails{\n                        twitterId\n                    }\n                }\n                borrowRate\n                borrowAmountRequested\n                loanStatus\n                published\n                loanStartTime\n                lentAmount\n                borrowAsset\n              }\n            }\n          }\n          `\n    })\n\n    var options = {\n        'method': 'POST',\n        'url': SUBGRAPH_API_URL,\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n\n    result = request(options, async function (error, response) {\n\n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        var pools = []\n        if(body){\n            if(body.data){\n                if(body.data.users && body.data.users.length>0){\n                    if(body.data.users[0].borrowingPools){\n                        let poolData = body.data.users[0].borrowingPools\n                        for(var i =0;i<poolData.length;i++){\n                            if(getLoanStartDay( poolData[i].loanStartTime) != 0){\n                                var pool = {\n                                    id: i+1,    \n                                    avatar: '',\n                                    name: ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    username: '@'+ethers.utils.parseBytes32String(poolData[i].borrower.twitterDetails.twitterId),\n                                    pool_type: 'Open Borrow',\n                                    pool_status: poolData[i].loanStatus,\n                                    // pool_status: 'Active',\n                                    created_on: '18th Jan 2021',\n                                    borrow_rate: (poolData[i].borrowRate)/10**8+'%',\n                                    borrowed_amount: (poolData[i].borrowAmountRequested)/10**18+' '+ getSymbol(poolData[i].borrowAsset),\n                                    progress_and_payment_txt: 'Collection Progress',\n                                    progress_and_payment: Math.floor((poolData[i].lentAmount*100)/poolData[i].borrowAmountRequested)+'%',\n                                    next_payment: '200 DOT',\n                                    ends_date: getLoanStartDay( poolData[i].loanStartTime),\n                                    btn_1: 'Provide collateral',\n                                    btn_2: 'View More',\n                                    address:poolData[i].id\n                                }\n                                pools.push(pool)\n                            }\n                            \n                        }\n                    }\n                }\n            }\n            \n        }\n        setpoolBorrowData(pools)\n    })\n    \n};"]},"metadata":{},"sourceType":"module"}