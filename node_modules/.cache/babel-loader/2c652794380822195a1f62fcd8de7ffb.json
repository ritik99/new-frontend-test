{"ast":null,"code":"import request from 'request'; // const Web3 = require(\"web3\");\n\nimport Web3 from \"web3\";\nconst web3 = new Web3(\"https://kovan.infura.io/v3/9dc997986f8840daa0e6ccb1d8d0d757\");\nconst aggregatorV3InterfaceABI = [{\n  \"inputs\": [],\n  \"name\": \"decimals\",\n  \"outputs\": [{\n    \"internalType\": \"uint8\",\n    \"name\": \"\",\n    \"type\": \"uint8\"\n  }],\n  \"stateMutability\": \"view\",\n  \"type\": \"function\"\n}, {\n  \"inputs\": [],\n  \"name\": \"description\",\n  \"outputs\": [{\n    \"internalType\": \"string\",\n    \"name\": \"\",\n    \"type\": \"string\"\n  }],\n  \"stateMutability\": \"view\",\n  \"type\": \"function\"\n}, {\n  \"inputs\": [{\n    \"internalType\": \"uint80\",\n    \"name\": \"_roundId\",\n    \"type\": \"uint80\"\n  }],\n  \"name\": \"getRoundData\",\n  \"outputs\": [{\n    \"internalType\": \"uint80\",\n    \"name\": \"roundId\",\n    \"type\": \"uint80\"\n  }, {\n    \"internalType\": \"int256\",\n    \"name\": \"answer\",\n    \"type\": \"int256\"\n  }, {\n    \"internalType\": \"uint256\",\n    \"name\": \"startedAt\",\n    \"type\": \"uint256\"\n  }, {\n    \"internalType\": \"uint256\",\n    \"name\": \"updatedAt\",\n    \"type\": \"uint256\"\n  }, {\n    \"internalType\": \"uint80\",\n    \"name\": \"answeredInRound\",\n    \"type\": \"uint80\"\n  }],\n  \"stateMutability\": \"view\",\n  \"type\": \"function\"\n}, {\n  \"inputs\": [],\n  \"name\": \"latestRoundData\",\n  \"outputs\": [{\n    \"internalType\": \"uint80\",\n    \"name\": \"roundId\",\n    \"type\": \"uint80\"\n  }, {\n    \"internalType\": \"int256\",\n    \"name\": \"answer\",\n    \"type\": \"int256\"\n  }, {\n    \"internalType\": \"uint256\",\n    \"name\": \"startedAt\",\n    \"type\": \"uint256\"\n  }, {\n    \"internalType\": \"uint256\",\n    \"name\": \"updatedAt\",\n    \"type\": \"uint256\"\n  }, {\n    \"internalType\": \"uint80\",\n    \"name\": \"answeredInRound\",\n    \"type\": \"uint80\"\n  }],\n  \"stateMutability\": \"view\",\n  \"type\": \"function\"\n}, {\n  \"inputs\": [],\n  \"name\": \"version\",\n  \"outputs\": [{\n    \"internalType\": \"uint256\",\n    \"name\": \"\",\n    \"type\": \"uint256\"\n  }],\n  \"stateMutability\": \"view\",\n  \"type\": \"function\"\n}]; // const request = require('request')\n\nexport function getTotalBorrowedAmount(address, setTotalBorrowAmount) {\n  const data = JSON.stringify({\n    query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n              id\n              borrowAmountRequested\n              borrowAsset\n              \n            }\n          } \n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    let totalBorrow = 0;\n\n    if (body) {\n      if (body.data) {\n        if (body.data.pools && body.data.pools.length > 0) {\n          for (var pool = 0; pool < body.data.pools.length; pool++) {\n            let addr;\n\n            if (body.data.pools[pool].borrowAsset = \"0x0000000000000000000000000000000000000000\") {\n              addr = \"0x9326BFA02ADD2366b30bacB125260Af641031331\";\n            }\n\n            const priceFeed = new web3.eth.Contract(aggregatorV3InterfaceABI, addr);\n            let roundData = (await priceFeed.methods.latestRoundData().call()).answer / 10 ** 8;\n            console.log(roundData);\n            totalBorrow += roundData * (parseInt(body.data.pools[pool].borrowAmountRequested) / 10 ** 18);\n          }\n        }\n      }\n    }\n\n    setTotalBorrowAmount(totalBorrow);\n  });\n}\nexport function getBorrowRate(address, setTotalBorrowRate) {\n  const data = JSON.stringify({\n    query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n                borrowRate\n            }\n          } \n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    let totalBorrowRate = 0;\n\n    if (body) {\n      if (body.data) {\n        if (body.data.pools && body.data.pools.length > 0) {\n          for (var pool = 0; pool < body.data.pools.length; pool++) {\n            totalBorrowRate = totalBorrowRate + parseInt(body.data.pools[pool].borrowRate);\n          }\n\n          if (body.data.pools.length == 0) {\n            setTotalBorrowRate(0);\n          } else {\n            setTotalBorrowRate(totalBorrowRate / body.data.pools.length);\n          }\n        }\n      }\n    } // console.log(totalBorrowRate,body.data.pools.length);\n\n  });\n}\nexport function getTotalLendAmount(address, setTotalLendAmount) {\n  console.log(\"working\");\n  const data = JSON.stringify({\n    query: `{\n            lendingDetailscopies(where:{lender:\"${address}\",loanStatus:\"Active\"}){\n             id\n             AmountLend\n             pool{\n                borrowAsset\n              }\n           }\n           }            \n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    let totalLend = 0;\n\n    if (body) {\n      if (body.data) {\n        console.log(body.data);\n\n        if (body.data.lendingDetailscopies && body.data.lendingDetailscopies.length > 0) {\n          for (var i = 0; i < body.data.lendingDetailscopies.length; i++) {\n            let addr;\n\n            if (body.data.lendingDetailscopies[i].pool.borrowAsset = \"0x0000000000000000000000000000000000000000\") {\n              addr = \"0x9326BFA02ADD2366b30bacB125260Af641031331\";\n            }\n\n            const priceFeed = new web3.eth.Contract(aggregatorV3InterfaceABI, addr);\n            let roundData = (await priceFeed.methods.latestRoundData().call()).answer / 10 ** 8;\n            totalLend += roundData * (parseInt(body.data.lendingDetailscopies[i].AmountLend) / 10 ** 18);\n          }\n\n          if (body.data.lendingDetailscopies.length == 0) {\n            setTotalLendAmount(0);\n          } else {\n            setTotalLendAmount(totalLend);\n          }\n        }\n      }\n    }\n  });\n}\nexport function getLendRate(address, setTotalLendRate) {\n  const data = JSON.stringify({\n    query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n                borrowRate\n            }\n          } \n          `\n  });\n  var options = {\n    'method': 'POST',\n    'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n    'headers': {\n      'Content-Type': 'application/json'\n    },\n    'body': data\n  };\n  let s = 0;\n  request(options, async function (error, response) {\n    if (error) throw new Error(error);\n    var body = JSON.parse(response.body);\n    let totalBorrowRate = 0;\n\n    if (body) {\n      if (body.data) {\n        if (body.data.pools && body.data.pools.length > 0) {\n          for (var pool = 0; pool < body.data.pools.length; pool++) {\n            totalBorrowRate = totalBorrowRate + parseInt(body.data.pools[pool].borrowRate);\n          }\n\n          if (body.data.pools.length == 0) {\n            setTotalLendRate(0);\n          } else {\n            setTotalLendRate((1 - s) * totalBorrowRate / body.data.pools.length);\n          }\n        }\n      }\n    } // console.log(totalBorrowRate,body.data.pools.length);\n\n  });\n} // getTotalBorrowedAmount(\"0x5a8043a7907c3a5c40ae52cff3abc026111ccd96\")\n// getBorrowRate(\"0x5a8043a7907c3a5c40ae52cff3abc026111ccd96\")","map":{"version":3,"sources":["/Users/ritikdutta/Desktop/sublime-frontend/src/utility/dashboard.js"],"names":["request","Web3","web3","aggregatorV3InterfaceABI","getTotalBorrowedAmount","address","setTotalBorrowAmount","data","JSON","stringify","query","options","error","response","Error","body","parse","totalBorrow","pools","length","pool","addr","borrowAsset","priceFeed","eth","Contract","roundData","methods","latestRoundData","call","answer","console","log","parseInt","borrowAmountRequested","getBorrowRate","setTotalBorrowRate","totalBorrowRate","borrowRate","getTotalLendAmount","setTotalLendAmount","totalLend","lendingDetailscopies","i","AmountLend","getLendRate","setTotalLendRate","s"],"mappings":"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","sourcesContent":["\nimport request from 'request'\n// const Web3 = require(\"web3\");\nimport Web3 from \"web3\"\nconst web3 = new Web3(\"https://kovan.infura.io/v3/9dc997986f8840daa0e6ccb1d8d0d757\");\nconst aggregatorV3InterfaceABI = [{\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"description\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint80\",\"name\":\"_roundId\",\"type\":\"uint80\"}],\"name\":\"getRoundData\",\"outputs\":[{\"internalType\":\"uint80\",\"name\":\"roundId\",\"type\":\"uint80\"},{\"internalType\":\"int256\",\"name\":\"answer\",\"type\":\"int256\"},{\"internalType\":\"uint256\",\"name\":\"startedAt\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"updatedAt\",\"type\":\"uint256\"},{\"internalType\":\"uint80\",\"name\":\"answeredInRound\",\"type\":\"uint80\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"latestRoundData\",\"outputs\":[{\"internalType\":\"uint80\",\"name\":\"roundId\",\"type\":\"uint80\"},{\"internalType\":\"int256\",\"name\":\"answer\",\"type\":\"int256\"},{\"internalType\":\"uint256\",\"name\":\"startedAt\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"updatedAt\",\"type\":\"uint256\"},{\"internalType\":\"uint80\",\"name\":\"answeredInRound\",\"type\":\"uint80\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"version\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"}];\n\n\n// const request = require('request')\nexport function getTotalBorrowedAmount(address,setTotalBorrowAmount){\n\n\n    const data = JSON.stringify({\n        query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n              id\n              borrowAmountRequested\n              borrowAsset\n              \n            }\n          } \n          `\n    })\n    var options = {\n        'method': 'POST',\n        'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n\n    request(options, async function (error, response) {\n\n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        let totalBorrow = 0;\n        if(body){\n            if(body.data){\n                if(body.data.pools && body.data.pools.length>0){\n                    for(var pool=0;pool<body.data.pools.length;pool++){\n                        let addr;\n                        if(body.data.pools[pool].borrowAsset = \"0x0000000000000000000000000000000000000000\"){\n                            addr = \"0x9326BFA02ADD2366b30bacB125260Af641031331\"\n                        }\n                        const priceFeed = new web3.eth.Contract(aggregatorV3InterfaceABI, addr);\n                        let roundData =  ((await priceFeed.methods.latestRoundData().call()).answer)/10**8;\n                        console.log(roundData);\n                        totalBorrow += roundData*(parseInt(body.data.pools[pool].borrowAmountRequested)/10**18)\n                    }\n\n                }\n            }\n        }\n        setTotalBorrowAmount(totalBorrow);\n        \n    })\n\n}\n\nexport function getBorrowRate(address,setTotalBorrowRate){\n\n    const data = JSON.stringify({\n        query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n                borrowRate\n            }\n          } \n          `\n    })\n    var options = {\n        'method': 'POST',\n        'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n    request(options, async function (error, response) {\n\n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        let totalBorrowRate = 0;\n        if(body){\n            if(body.data){\n                if(body.data.pools && body.data.pools.length>0){\n                    for(var pool=0;pool<body.data.pools.length;pool++){\n                        totalBorrowRate= totalBorrowRate + parseInt(body.data.pools[pool].borrowRate);\n                    }\n                    if(body.data.pools.length == 0){\n                        setTotalBorrowRate(0);\n                    }\n                    else{\n                        setTotalBorrowRate(totalBorrowRate/body.data.pools.length);\n                    }\n\n                }\n            }\n        }\n        \n        \n        // console.log(totalBorrowRate,body.data.pools.length);\n\n    })\n\n}\n\nexport function getTotalLendAmount(address,setTotalLendAmount){\n\n    \n    console.log(\"working\")\n    const data = JSON.stringify({\n        query: `{\n            lendingDetailscopies(where:{lender:\"${address}\",loanStatus:\"Active\"}){\n             id\n             AmountLend\n             pool{\n                borrowAsset\n              }\n           }\n           }            \n          `\n    })\n    var options = {\n        'method': 'POST',\n        'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n\n    request(options, async function (error, response) {\n\n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        let totalLend = 0;\n        if(body){\n            if(body.data){\n                console.log(body.data)\n                if(body.data.lendingDetailscopies && body.data.lendingDetailscopies.length>0){\n                    for(var i=0;i<body.data.lendingDetailscopies.length;i++){\n                        let addr;\n                        if(body.data.lendingDetailscopies[i].pool.borrowAsset = \"0x0000000000000000000000000000000000000000\"){\n                            addr = \"0x9326BFA02ADD2366b30bacB125260Af641031331\"\n                        }\n                        const priceFeed = new web3.eth.Contract(aggregatorV3InterfaceABI, addr);\n                        let roundData =  ((await priceFeed.methods.latestRoundData().call()).answer)/10**8;\n                        \n                        totalLend += roundData*(parseInt(body.data.lendingDetailscopies[i].AmountLend)/10**18)\n                    }\n                    if(body.data.lendingDetailscopies.length == 0){\n                        setTotalLendAmount(0);\n                    }\n                    else{\n                        setTotalLendAmount(totalLend);\n                    }\n\n                }\n            }\n        }\n      \n        \n    })\n\n}\n\n\nexport function getLendRate(address,setTotalLendRate){\n\n    const data = JSON.stringify({\n        query: `{\n            pools(where:{borrower:\"${address}\",loanStatus:\"Active\"}) {\n                borrowRate\n            }\n          } \n          `\n    })\n    var options = {\n        'method': 'POST',\n        'url': 'https://api.thegraph.com/subgraphs/name/sublime-finance/sublime',\n        'headers': {'Content-Type': 'application/json'},\n        'body': data\n    }       \n\n    let s = 0\n\n    request(options, async function (error, response) {\n        \n        if (error) throw new Error(error); \n        var body = JSON.parse(response.body)\n        let totalBorrowRate = 0;\n        if(body){\n            if(body.data){\n                if(body.data.pools && body.data.pools.length>0){\n                    for(var pool=0;pool<body.data.pools.length;pool++){\n                        totalBorrowRate= totalBorrowRate + parseInt(body.data.pools[pool].borrowRate);\n                    }\n                    if(body.data.pools.length == 0){\n                        setTotalLendRate(0);\n                    }\n                    else{\n                        setTotalLendRate((1-s)*totalBorrowRate/body.data.pools.length);\n                    }\n\n                }\n            }\n        }\n        \n        \n        // console.log(totalBorrowRate,body.data.pools.length);\n\n    })\n\n}\n\n\n// getTotalBorrowedAmount(\"0x5a8043a7907c3a5c40ae52cff3abc026111ccd96\")\n// getBorrowRate(\"0x5a8043a7907c3a5c40ae52cff3abc026111ccd96\")\n"]},"metadata":{},"sourceType":"module"}